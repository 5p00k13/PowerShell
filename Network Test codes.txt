$targetHost = "google.com"; $testPort = 80; $logFile = "C:\network_diagnostic_log.txt"; function Log-Output { param ([string]$message) Write-Output $message }; if (Test-Path $logFile) { Remove-Item $logFile }; Log-Output "Testing network connection (ping) to $targetHost..."; $pingResult = Test-Connection -ComputerName $targetHost -Count 4 -ErrorAction SilentlyContinue; if ($pingResult) { Log-Output "Ping test successful."; Log-Output ($pingResult | Out-String) } else { Log-Output "Ping test failed." }; Log-Output "`nPerforming traceroute to $targetHost..."; $tracerouteResult = tracert $targetHost; Log-Output ($tracerouteResult | Out-String); Log-Output "`nTesting DNS resolution for $targetHost..."; $dnsResult = Resolve-DnsName $targetHost -ErrorAction SilentlyContinue; if ($dnsResult) { Log-Output "DNS resolution successful."; Log-Output ($dnsResult | Out-String) } else { Log-Output "DNS resolution failed." }; Log-Output "`nRetrieving network adapter configuration..."; $netIPConfig = Get-NetIPConfiguration; Log-Output ($netIPConfig | Out-String); Log-Output "`nTesting port connectivity to $targetHost on port $testPort..."; $portTestResult = Test-NetConnection -ComputerName $targetHost -Port $testPort -ErrorAction SilentlyContinue; if ($portTestResult.TcpTestSucceeded) { Log-Output "Port $testPort on $targetHost is open." } else { Log-Output "Port $testPort on $targetHost is closed or blocked." }; Log-Output "`nPerforming download speed test..."; $downloadTest = Measure-Command { Invoke-WebRequest -Uri "http://www.example.com" -UseBasicParsing }; $downloadSpeedMB = 1MB / $downloadTest.TotalSeconds; $downloadSpeedGB = $downloadSpeedMB / 1024; Log-Output ("Download speed: {0:N6} GB/s" -f $downloadSpeedGB); Log-Output "`nPerforming upload speed test..."; $uploadTest = Measure-Command { Invoke-WebRequest -Uri "http://www.example.com" -Method POST -Body ($null * 1MB) -UseBasicParsing }; $uploadSpeedMB = 1MB / $uploadTest.TotalSeconds; $uploadSpeedGB = $uploadSpeedMB / 1024; Log-Output ("Upload speed: {0:N6} GB/s" -f $uploadSpeedGB); Log-Output "`nNetwork diagnostic test completed."
